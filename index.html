<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Project1: Images of the Russian Empire</title>
  <style>
    body {
      background-color: #D8C3DD; /* 紫色背景 */
      font-family: Arial, sans-serif;
      color: white;
      margin: 0;
      padding: 0;
    }
    /* 导航栏 */
    nav {
      background: rgba(0, 0, 0, 0.3);
      padding: 10px 20px;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    nav a {
      color: #ffddff;
      text-decoration: none;
      margin: 0 15px;
      font-weight: bold;
    }
    nav a:hover {
      text-decoration: underline;
    }
    .container {
      width: 80%;
      margin: auto;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-top: 20px;
    }
    .section {
      background: rgba(0,0,0,0.2);
      padding: 20px;
      margin: 40px 0;
      border-radius: 12px;
    }
    .section h2 {
      color: #ffddff;
      text-align: center;
    }
    img {
      max-width: 100%;
      border-radius: 8px;
    }
    .row {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .img-block {
      text-align: center;
    }
    .img-block p {
      margin-top: 8px;
      font-size: 16px;
      text-align: center;
    }
    p {
      text-align: left;
      max-width: 1000px;
      margin: auto;
      margin-bottom: 20px;
      font-size: 18px;
    }
  </style>
  <!-- MathJax 支持公式渲染 -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
  <!-- 导航栏 -->
  <nav>
    <a href="#part1">Part1</a>
    <a href="#part2">Part2</a>
    <a href="#part3">Part3</a>
    <a href="#part4">Part4</a>
  </nav>

  <div class="container">
    <h1>Project1: Images of the Russian Empire: Colorizing the Prokudin-Gorskii photo collection</h1>
    <p style="text-align:center; font-style:italic;">Freya Sun</p>

    <!-- Part1 -->
    <div class="section" id="part1">
      <h2>Part1: Single-scale alignment</h2>
      <h3>Method</h3>
      <p>
        For low-resolution images, I used a single-scale alignment approach. The image was first converted to floating point with pixel values normalized to the range [0,1]. It was then split into three color channels (blue, green, and red). The blue channel served as the reference. 
      </p>
      <p>
        For the other two channels, I performed an exhaustive search over a displacement window ([-15, 15] pixels). Each candidate shift was evaluated using <b>Normalized Cross-Correlation (NCC)</b>, defined as:
      </p>
      <p style="text-align:center;">
        $$\text{NCC}(A,B) = \frac{\sum_{x,y} (A(x,y) - \bar{A})(B(x,y) - \bar{B})}{\sqrt{\sum_{x,y}(A(x,y)-\bar{A})^2} \, \sqrt{\sum_{x,y}(B(x,y)-\bar{B})^2}}$$
      </p>
      <p>
        where A and B are the overlapping image regions and \(\bar{A}, \bar{B}\) are their mean values.
      </p>
      <p>
        In each shift, I used <code>np.roll</code> to translate the moving channel. To avoid artifacts from image borders and wrap-around, I applied a <code>crop_interior</code> function to discard a small fraction of the edges before scoring. After determining the optimal displacements for the red and green channels, they were aligned with the blue channel to form the final color image.
      </p>
      <h3>Results</h3>
      <div class="row">
        <div class="img-block">
          <img src="cathedral_out.jpg" alt="cathedral result" width="300">
          <p>cathedral<br>G (5,2), R (12,3)</p>
        </div>
        <div class="img-block">
          <img src="monastery_out.jpg" alt="monastery result" width="300">
          <p>monastery<br>G (-3,2), R (3,2)</p>
        </div>
        <div class="img-block">
          <img src="tobolsk_out.jpg" alt="tobolsk result" width="300">
          <p>tobolsk<br>G (3,3), R (6,3)</p>
        </div>
      </div>
    </div>

    <!-- Part2 -->
    <div class="section" id="part2">
      <h2>Part2: Pyramid alignment</h2>
      <h3>Method</h3>
      <p>
  To handle the large .tif images, I implemented a <b>coarse-to-fine pyramid alignment</b>.
  The idea is to build an image pyramid by repeatedly downsampling the original channels by a factor of 2.
  Before each downsampling step, I applied a <b>Gaussian blur</b> to reduce aliasing artifacts.
</p>

<p>
  Alignment starts at the coarsest (smallest) level, where exhaustive search is cheap, and is refined step by step at finer levels.
  Instead of using a fixed search window, I gradually decreased the search radius across levels: <b>[15, 10, 7, 5, 3]</b> pixels.
  This allows broad exploration at coarse scales and fine-tuned adjustments at higher resolutions.
</p>

<p>
  For similarity measurement, I used <b>Normalized Cross-Correlation (NCC)</b>, which is robust to brightness differences.
  To reduce boundary artifacts, a <code>crop_interior</code> function removes about 10% from each side before scoring.
</p>

<p>
  This pyramid approach greatly improves both speed and accuracy compared to single-scale exhaustive search,
  making it well-suited for high-resolution glass plate scans.
</p>

      <h3>Results</h3>
      <div class="row">
        <div class="img-block"><img src="church_out.jpg" alt="church" height="180"><p>church<br>G (5,2), R (12,3)</p></div>
        <div class="img-block"><img src="harvesters_out.jpg" alt="harvesters" height="180"><p>harvesters<br>G (60,17), R (124,13)</p></div>
        <div class="img-block"><img src="emir_out.jpg" alt="emir" height="180"><p>emir<br>G (49,24), R (107, 40)</p></div>
        <div class="img-block"><img src="three_generations_out.jpg" alt="three generations" height="180"><p>three_generations<br>G (53,14), R (112,11)</p></div>
      </div> 
        <div class="row"> 
          <div class="img-block"><img src="lastochikino_out.jpg" alt="lastochikino" height="180"><p>lastochikino<br>G (-3,-2), R (75,-9)</p></div> 
          <div class="img-block"><img src="italil_out.jpg" alt="italil" height="180"><p>italil<br>G (38,21), R (76,35)</p></div> 
          <div class="img-block"><img src="icon_out.jpg" alt="icon" height="180"><p>icon<br>G (41,17), R (89,23)</p></div> 
          <div class="img-block"><img src="melons_out.jpg" alt="melons" height="180"><p>melons<br>G (81,10), R (179, 12)</p></div> 
        </div> 
      <div class="row"> 
        <div class="img-block"><img src="lugano_out.jpg" alt="lugano" height="180"><p>lugano<br>G (41, -17), R (92, -29)</p></div> 
        <div class="img-block"><img src="self_portrait_out.jpg" alt="self portrait" height="180"><p>self_portrait<br>G (79, 29), R (176, 37)</p></div> 
        <div class="img-block"><img src="siren_out.jpg" alt="siren" height="180"><p>siren<br>G (49, -6), R (96, -25)</p></div>
      </div>
    </div>

    <!-- Part3 -->
    <div class="section" id="part3">
      <h2>Part3: Results On My Own Images</h2>
      <h3>Results</h3>
      <div class="row">
        <div class="img-block">
          <img src="train_out.jpg" alt="train result" width="300">
          <p>train<br>G (41, 2), R (85, 30)</p>
        </div>
        <div class="img-block">
          <img src="master_out.jpg" alt="master result" width="300">
          <p>master<br>G (38, 11), R (93, 15)</p>
        </div>
        <div class="img-block">
          <img src="field_out.jpg" alt="field result" width="300">
          <p>field<br>G (32, 5), R (79, 7)</p>
        </div>
      </div>
    </div>

    <!-- Part4 -->
    <div class="section" id="part4">
      <h2>Part4: Bells & Whistles</h2>
      <p>
        Comparing the two images below, the left uses only NCC while the right applies Sobel + NCC. We can see that applying the Sobel operator before alignment often produces more stable and accurate results. The Sobel operator is a simple gradient-based filter commonly used for edge detection. Instead of relying on absolute brightness, it highlights intensity changes, emphasizing structural features like object boundaries and textures while reducing the influence of uneven illumination. As a result, alignment is guided more by the geometry of the scene and becomes less sensitive to exposure differences. 
      </p>
      <h3>Comparison</h3>
      <div class="row">
        <div class="img-block">
          <img src="emir_bad_out.jpg" alt="emir bad" height="260">
          <p>emir_bad</p>
        </div>
        <div class="img-block">
          <img src="emir_out.jpg" alt="emir" height="260">
          <p>emir_good</p>
        </div>
      </div>
    </div>

  </div>
</body>
</html>
